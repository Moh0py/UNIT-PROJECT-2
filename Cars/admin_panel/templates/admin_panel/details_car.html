{% extends 'pages/base.html' %}
{% load static %}

{% block content %}
  <div class="container my-5">
    <h2>{{ car.name }} {{ car.model }} ({{ car.year }})</h2>
    <p><strong>Brand:</strong> {{ car.brand }}</p>
    <p><strong>Price:</strong> ${{ car.price }}</p>
    <p>{{ car.description }}</p>

    <h4 class="mt-4">Gallery</h4>
    <div class="row">
      {% if car.front_image %}
        <div class="col-md-6 mb-3">
          <div class="card">
            <img src="{{ car.front_image.url }}" class="card-img-top" alt="{{ car.name }} - Front View" style="height: 300px; object-fit: cover;">
            <div class="card-body">
              <p class="card-text text-center"><strong>Front View</strong></p>
            </div>
          </div>
        </div>
      {% endif %}

      {% if car.back_image %}
        <div class="col-md-6 mb-3">
          <div class="card">
            <img src="{{ car.back_image.url }}" class="card-img-top" alt="{{ car.name }} - Back View" style="height: 300px; object-fit: cover;">
            <div class="card-body">
              <p class="card-text text-center"><strong>Back View</strong></p>
            </div>
          </div>
        </div>
      {% endif %}

      {% for img in front_image %}
        <div class="col-md-4 mb-3">
          <div class="card">
            <img src="{{ img.image.url }}" class="card-img-top" alt="{{ img.alt_text|default:car.name }}" style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <p class="card-text small text-muted text-center">{{ img.alt_text|default:"Gallery Image" }}</p>
            </div>
          </div>
        </div>
      {% endfor %}

      {% if not car.front_image and not car.back_image and not car.gallery_images.all %}
        <div class="col-12">
          <p class="text-muted text-center">No images found</p>
        </div>
      {% endif %}
    </div>

    {% if user.is_staff %}
    <div class="mt-4">
      <h5>Add Additional Images</h5>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
          <label for="id_images" class="form-label">Upload Images (you can select multiple)</label>
          <input
            type="file"
            name="images"
            id="id_images"
            class="form-control"
            accept="image/*"
            multiple>
        </div>
        <button type="submit" class="btn btn-primary">Upload Images</button>
      </form>
    </div>
    {% endif %}

    <h4 class="mt-5">3D Model</h4>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    {% if car.model_3d_url %}
      <model-viewer
        src="{{ car.model_3d_url }}"
        alt="{{ car.name }} 3D Model"
        camera-controls
        auto-rotate
        ar
        ios-src="{{ car.model_3d_url }}"
        style="width:100%; height:400px; background-color: #f8f9fa; border-radius: 8px;">
      </model-viewer>
    {% else %}
      <p class="text-muted">No 3D view available.</p>
    {% endif %}

    <h4 class="mt-5">Reviews</h4>
    {% for review in car.reviews.all %}
      <div class="card mt-3">
        <div class="card-body">
          <h5 class="card-title">{{ review.name }}</h5>
          <div class="mb-2">
              
          </div>
          <p class="card-text">{{ review.comment }}</p>
          <small class="text-muted">Reviewed on {{ review.created_at|date:"Y-m-d H:i" }}</small>
        </div>
      </div>
    {% empty %}
      <div class="alert alert-info">
        <p class="mb-0">No reviews yet. Be the first to review this car!</p>
      </div>
    {% endfor %}
{% endblock %}